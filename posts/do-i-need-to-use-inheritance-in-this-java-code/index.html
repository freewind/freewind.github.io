<!DOCTYPE html>
<html>
<head>
    <title>项目中的一处java代码，是否应该使用继承？</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<link rel='stylesheet' href='/css/main.css' type='text/css' media='all' />

</head>
<body>

<h1>
    项目中的一处java代码，是否应该使用继承？
</h1>

<div>
    <hr />
<p>在项目中遇到过几次使用了继承的情形，有的是别人用了但我认为不该用，有的是我用的但别人认为不该用。对于这些代码，虽然我有一些思考，但还是很不确定，所以记录下来，希望与更多的人交流。</p>
<p>由于项目有保密要求，所以我对代码进行了一些修改，让它们成为更能用的问题。</p>
<h2>例一</h2>
<p>项目中使用了一个第三方存储设备，它提供了一些api供保存和读取。我们先定义了一个通用的存取类：<code>StorageService</code>:</p>
<pre><code>public class StorageService {
    public void save(String key, String content) { ... }
    public String get(String key) { ... }
}


可以看出这是一个很通用的服务类，可以根据key保存或读取一些文本。

项目中定义了很多module，都要用到这个StorageService，但要提供一些跟自己module相关的方法供调用，通常会提供与module相关的key。比如有一个`UserStorageService`:

public class UserStorageService extends StorageService {
    public void saveUser(String userId, String userInfoInXmlFormat) {
        super.save("user.info." + userId, userInfoInXmlFormat);
    }
    public String getUser(String userId) {
        return super.get("user.info." + userId);
    }
}


可以看到，`UserStorageService`继承了`StorageService`，同时提供了自己的方法供调用。看到这段代码时，我感觉似乎没有必要使用“继承”。如果是我的话，我会这么来写：

public class UserStorageService {
    private StorageService storageService = new StorageService();
    public void saveUser(String userId, String userInfoInXmlFormat) {
        storageService.save("user.info." + userId, userInfoInXmlFormat);
    }
    public String getUser(String userId) {
        return storageService.get("user.info." + userId);
    }
}
</code></pre>
<p>这里使用了“组合”（我不知道是不是该用这个词，如果有误请指正）。相对于前面用继承的代码，它有两个好处：</p>
<ol>
<li>用户只能调用<code>saveUser</code>和<code>getUser</code>这两个作用非常明确的方法。如果是继承的版本，则用户还可以调用<code>save</code>和<code>get</code>这两个通用的方法，会让人疑惑及误用</li>
<li><code>UserStorageService</code>还有机会继承其它的类，因为在java中，只能单继承</li>
</ol>
<p>但是这两个好处是不是决定性的因素呢？如果<code>StorageService</code>中还提供了一些其它需要被调用的方法，或者我们根本不需要让<code>UserService</code>继承别的类，是不是这两种方案的优劣对比就不明显了呢？</p>
<p>老猪说，判断是否该使用继承要看&#8221;is_a&#8221;，是否该用组合要看&#8221;has_a&#8221;。但<code>UserStorageService</code>与<code>StorageService</code>的关系，是&#8221;is_a&#8221;，还是&#8221;has_a&#8221;呢？我好像也没法确定。</p>
<p>（注：本文本来有两个例子，由于内容增加，并且例子的差别较大，我分成了两篇）</p>

</div>
</body>
</html>
